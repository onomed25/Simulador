<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Lista de Ações da B3</title>
    <link rel="stylesheet" href="/css/styles_b3.css"> 
    <link rel="stylesheet" href="/css/styles_menu.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/all.min.css">
</head>
<body>
    <header>
        <div class="header-container">
            <h1>Lista de Ações</h1>
            <!-- Botão de menu hambúrguer -->
            <button class="menu-toggle" aria-label="Abrir menu">
             <i class='fas fa-bars' style='color:#969696'></i><!-- Ícone de hambúrguer -->
            </button>
            <nav>
                <a href="/index.html">Renda Fixa</a>
                <a href="/html/earn.html">Earn</a>
                <a href="/html/b3.html" class="active">Renda Varial</a>
                <button class="login-button">Login</button>
            </nav>
          
        </div>
    </header>

    <div id="erro" class="erro" style="display: none;"></div>

    <ul id="listaAcoes">
        <!-- Ações serão carregadas aqui -->
    </ul>

    <script>
       async function pegarValorAcao(acao) {
            const proxyUrl = 'https://api.allorigins.win/get?url='; // Proxy para contornar CORS
            const url = `https://www.fundsexplorer.com.br/funds/${acao}`; // URL do fundo/ação

            try {
                const response = await fetch(proxyUrl + encodeURIComponent(url));
                const data = await response.json();
                
                const html = data.contents;
                const parser = new DOMParser();
                const doc = parser.parseFromString(html, 'text/html');

                const valorElemento = doc.querySelector('.headerTicker__content__price');
                const variacaoElemento = doc.querySelector('.alta');

                if (valorElemento && variacaoElemento) {
                    let valor = valorElemento.textContent.trim();
                    let variacao = variacaoElemento.textContent.trim();

                    valor = valor.replace(/[^\d,.-]/g, '');
                    variacao = variacao.replace(/[^\d,.-]/g, '');
                    
                    return { valor, variacao };
                } else {
                    throw new Error('Valor ou variação não encontrados');
                }
            } catch (error) {
                console.error('Erro ao buscar valor da ação:', error);
                return { valor: 'Erro ao carregar', variacao: 'Erro ao carregar' };
            }
        }

        async function carregarAcoes() {
            const acoes = [
                { simbolo: 'mxrf11', nome: 'MXRF11 - Fundo Imobiliário' },
                {simbolo: 'gare11', nome: 'GARE11 - Fundo Imobiliário'},
                {simbolo: 'xpsf11', nome: 'XPSF11 - Fundo De Fundos'}
            ];

            const listaAcoes = document.getElementById('listaAcoes');
            const erroDiv = document.getElementById('erro');
            erroDiv.style.display = 'none';

            for (const acao of acoes) {
                const { valor, variacao } = await pegarValorAcao(acao.simbolo);

                if (valor === 'Erro ao carregar' || variacao === 'Erro ao carregar') {
                    erroDiv.style.display = 'block';
                    erroDiv.textContent = 'Erro ao carregar algumas ações.';
                    continue;
                }

                const valorNumerico = parseFloat(valor.replace(',', '.'));
                const variacaoNumerica = parseFloat(variacao.replace(',', '.'));

                const valorClasse = valorNumerico > 0 ? 'valor-positivo' : 'valor-negativo';
                const variacaoClasse = variacaoNumerica >= 0 ? 'variacao-positivo' : 'variacao-negativo';

                const valorFormatado = `R$ ${valorNumerico.toLocaleString('pt-BR', { minimumFractionDigits: 2, maximumFractionDigits: 2 })}`;
                const variacaoFormatada = `${(variacaoNumerica).toFixed(2)}%`;

                const li = document.createElement('li');
                li.innerHTML = `<a href="Rendimento?fundo=${acao.simbolo}">${acao.nome}</a>
                                <span class="valor ${valorClasse}">${valorFormatado}</span>
                                <span class="variacao ${variacaoClasse}">${variacaoFormatada}</span>`;
                listaAcoes.appendChild(li);

                const linkAcao = li.querySelector('.acao-link');
                linkAcao.addEventListener('click', (event) => {
                    event.preventDefault(); // Impede o redirecionamento para outra página

                    // Exibe informações no modal
                    document.getElementById('acaoNome').textContent = acao.nome;
                    document.getElementById('acaoDetalhes').textContent = `Detalhes sobre a ação ${acao.nome}. Valor: ${valorFormatado}, Variação: ${variacaoFormatada}`;

                    // Exibe o modal
                    document.getElementById('modal').style.display = 'block';
                });
            }
        }

        // Fechar o modal
        const closeButton = document.querySelector('.close-btn');
        closeButton.addEventListener('click', () => {
            document.getElementById('modal').style.display = 'none';
        });

        // Chama a função para carregar as ações e seus valores
        carregarAcoes();
    </script>
      <script src="/JS/script_menu.js"></script>
</body>
</html>
